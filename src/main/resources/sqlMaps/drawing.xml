<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="drawingMapper">

    <select id="selectDrawingEquipment" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT EQUIP_ID, EQUIP_NM, FACTORY_AREA
        FROM TBL_EQUIP
        WHERE DEL_YN ='N'
    </select>

    <select id="selectDrawingUser" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT A.USER_ID, A.USER_NM, B.FILE_PATH
        FROM TBL_USER A
            LEFT OUTER JOIN TBL_FILE B ON A.PHOTO_GFILE_SEQ = B.GFILE_SEQ
        WHERE 1=1
    </select>

    <select id="selectDrawingBoardLastWork" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT
            Z.USER_NM, F.EQUIP_NM, F.EQUIP_ID, F.FACTORY_AREA, C.CONTROL_NUM, B.CONTROL_SEQ, B.CONTROL_DETAIL_SEQ, D.BARCODE_NUM,
            B.PART_NUM, SUBSTRING_INDEX(B.INNER_DUE_DT, '-' , -2 ) AS INNER_DUE_DT, E.ORDER_QTY,
            C.EMERGENCY_YN, C.MAIN_INSPECTION
        FROM TBL_MCT_WORK A
            INNER JOIN TBL_CONTROL_PART B ON A.CONTROL_SEQ = B.CONTROL_SEQ AND A.CONTROL_DETAIL_SEQ = B.CONTROL_DETAIL_SEQ
            INNER JOIN TBL_CONTROL C ON B.CONTROL_SEQ = C.CONTROL_SEQ AND C.DEL_YN = 'N'
            INNER JOIN TBL_CONTROL_BARCODE D ON D.CONTROL_SEQ = B.CONTROL_SEQ AND D.CONTROL_DETAIL_SEQ = B.CONTROL_DETAIL_SEQ AND D.DEL_YN = 'N'
            INNER JOIN TBL_MATERIAL_ORDER E ON D.CONTROL_SEQ = E.CONTROL_SEQ AND D.CONTROL_DETAIL_SEQ = E.CONTROL_DETAIL_SEQ
            INNER JOIN TBL_EQUIP F ON A.EQUIP_ID = F.EQUIP_ID AND F.DEL_YN = 'N'
                AND F.FACTORY_AREA = #{FACTORY_AREA}
            LEFT OUTER JOIN TBL_USER Z ON Z.USER_ID = #{USER_ID} AND Z.DEL_YN ='N'
        WHERE A.EQUIP_ID = #{EQUIP_ID}
    </select>
</mapper>
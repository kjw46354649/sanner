<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="drawingMapper">

    <select id="selectDrawingEquipment" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT EQUIP_SEQ, EQUIP_NM, FACTORY_AREA
        FROM TBL_EQUIP
        WHERE DEL_YN ='N'
    </select>

    <select id="selectDrawingUser" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT A.USER_ID, A.USER_NM, B.FILE_PATH
        FROM TBL_USER A
            LEFT OUTER JOIN TBL_FILE B ON A.PHOTO_GFILE_SEQ = B.GFILE_SEQ
        WHERE 1=1
    </select>

    <select id="selectDrawingBoardLastWork" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT
			Z.USER_ID, Z.USER_NM, Z.POSITION_NM, Z.JOB_TITLE,
			A.EQUIP_NM, A.EQUIP_SEQ, A.FACTORY_AREA, SF_GET_CODE_NM('1005', A.FACTORY_AREA, 'EN') AS FACTORY_NM,
            D.CONTROL_NUM, D.CONTROL_SEQ, C.CONTROL_DETAIL_SEQ, E.BARCODE_NUM,
            C.PART_NUM, SUBSTRING_INDEX(C.INNER_DUE_DT, '-' , -2 ) AS INNER_DUE_DT, F.ORDER_QTY,
            D.EMERGENCY_YN, D.MAIN_INSPECTION
        FROM TBL_EQUIP A
			LEFT OUTER JOIN TBL_MCT_WORK B ON A.EQUIP_SEQ = B.EQUIP_SEQ
            LEFT OUTER JOIN TBL_CONTROL_PART C ON B.CONTROL_SEQ = C.CONTROL_SEQ AND B.CONTROL_DETAIL_SEQ = C.CONTROL_DETAIL_SEQ
            LEFT OUTER JOIN TBL_CONTROL D ON C.CONTROL_SEQ = D.CONTROL_SEQ AND D.DEL_YN = 'N'
            LEFT OUTER JOIN TBL_CONTROL_BARCODE E ON E.CONTROL_SEQ = C.CONTROL_SEQ AND E.CONTROL_DETAIL_SEQ = C.CONTROL_DETAIL_SEQ AND E.DEL_YN = 'N'
            LEFT OUTER JOIN TBL_MATERIAL_ORDER F ON E.CONTROL_SEQ = F.CONTROL_SEQ AND E.CONTROL_DETAIL_SEQ = F.CONTROL_DETAIL_SEQ
            LEFT OUTER JOIN TBL_USER Z ON Z.USER_ID = #{USER_ID} AND Z.DEL_YN = 'N'
        WHERE 1=1
			AND A.FACTORY_AREA = #{FACTORY_AREA}
            AND A.EQUIP_SEQ = #{EQUIP_SEQ}
    </select>
</mapper>
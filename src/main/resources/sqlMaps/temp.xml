<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="drawingTempMapper">

    <insert id="insertDrawingUpload" parameterType="java.util.HashMap">
        INSERT INTO jmes.TBL_DRAWING_UPLOAD
            (WORK_KEY, GFILE_SEQ, FILE_TYPE, MAPPING_STR, DXF_GFILE_SEQ, PDF_GFILE_SEQ, IMG_GFILE_SEQ, SUCCESS, MESSAGE, INSERT_ID)
        VALUES
            (#{WORK_KEY}, #{GFILE_SEQ}, #{FILE_TYPE}, #{MAPPING_STR}, #{DXF_GFILE_SEQ}, #{PDF_GFILE_SEQ}, #{IMG_GFILE_SEQ}, #{SUCCESS}, #{MESSAGE}, #{LOGIN_USER_ID})
    </insert>

    <select id="selectDrawingUploadFileList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT
            UUID() AS ROW_NUM,
           	C.ORGINAL_FILE_NM, C.FILE_EXT, C.FILE_SIZE, A.MAPPING_STR, A.MESSAGE, A.SUCCESS,
            A.DXF_GFILE_SEQ, A.DXF_GFILE_SEQ, A.IMG_GFILE_SEQ
        FROM jmes.TBL_DRAWING_UPLOAD A
            INNER JOIN jmes.TBL_FILE_GROUP B ON A.GFILE_SEQ = B.GFILE_SEQ
            INNER JOIN jmes.TBL_FILE C ON B.GFILE_SEQ = C.GFILE_SEQ
         WHERE A.WORK_KEY = #{WORK_KEY}
         ORDER BY A.UPLOAD_SEQ
    </select>

    <select id="selectDrawingUploadControlDataList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT
            A.GFILE_SEQ AS DXF_GFILE_SEQ, B.FILE_SEQ, B.TIME_PATH, B.FILE_PATH, REPLACE(B.ORGINAL_FILE_NM, CONCAT('.',B.FILE_EXT), SPACE(0)) AS ORGINAL_FILE_NM,
            REPLACE(B.FILE_NM, CONCAT('.',B.FILE_EXT), SPACE(0)) AS FILE_NM, B.FILE_SIZE,
            SF_GET_DATE_F(B.INSERT_DT,'YYYY','') AS INSERT_DT
        FROM jmes.TBL_FILE_GROUP A
            INNER JOIN jmes.TBL_FILE B ON A.GFILE_SEQ = B.GFILE_SEQ
        WHERE A.GFILE_SEQ  IN
            <foreach collection="dxfGfileSeqList" item="bean" index="index"  open="(" close=")" separator=",">
                #{bean}
            </foreach>
    </select>

</mapper>

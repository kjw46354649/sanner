<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="tvMapper">

    <select id="selectTvPopList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        -- POP Info
        SELECT B.POP_SEQ
            , B.POP_POSITION
            , B.CONTROL_SEQ
            , B.CONTROL_DETAIL_SEQ
            , CASE WHEN D.PART_NUM IS NULL THEN C.CONTROL_NUM ELSE CONCAT(C.CONTROL_NUM,'#',D.PART_NUM) END AS CONTROL_PART_INFO
            , COUNT(*) OVER (PARTITION BY B.POP_POSITION) AS TOTAL_CNT
            , D.IMG_GFILE_SEQ
        FROM (  SELECT M.CONTROL_SEQ, M.CONTROL_DETAIL_SEQ, MAX(M.POP_SEQ) AS POP_SEQ
                FROM jmes.TBL_POP M
                WHERE NOT EXISTS (SELECT 1 FROM jmes.TBL_CONTROL N, jmes.TBL_CONTROL_PART O
                    WHERE O.CONTROL_SEQ = M.CONTROL_SEQ AND O.CONTROL_DETAIL_SEQ = M.CONTROL_DETAIL_SEQ
                      AND N.CONTROL_SEQ = O.CONTROL_SEQ
                      AND N.DEL_YN = 'N'
                      AND N.OUT_FINISH_DT IS NOT NULL)
                GROUP BY M.CONTROL_SEQ, M.CONTROL_DETAIL_SEQ
             ) A, jmes.TBL_POP B, jmes.TBL_CONTROL C, jmes.TBL_CONTROL_PART D
        WHERE A.POP_SEQ = B.POP_SEQ
            AND B.CONTROL_SEQ = C.CONTROL_SEQ
            AND B.CONTROL_SEQ = D.CONTROL_SEQ
            <if test="POP_POSITION != null and POP_POSITION != ''">
                AND B.POP_POSITION = #{POP_POSITION}
            </if>
            AND B.CONTROL_DETAIL_SEQ = D.CONTROL_DETAIL_SEQ
            AND C.DEL_YN = 'N'
            AND NOT EXISTS (SELECT 1 FROM jmes.TBL_CONTROL_PART E
                          WHERE D.CONTROL_SEQ = E.CONTROL_SEQ AND D.CONTROL_DETAIL_SEQ = E.CONTROL_DETAIL_SEQ
                              AND E.PART_STATUS = 'PRO018' AND E.WORK_TYPE = 'WTP050'
            )
        ORDER BY B.POP_SEQ DESC
        <if test="LIMIT != null and LIMIT != ''">
            LIMIT ${LIMIT}
        </if>
    </select>

    <select id="selectTvPopList2" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        -- 소재대기
        SELECT CASE WHEN B.PART_NUM IS NULL THEN A.CONTROL_NUM ELSE CONCAT(A.CONTROL_NUM,'#',B.PART_NUM) END AS CONTROL_PART_INFO
            , B.IMG_GFILE_SEQ
            , COUNT(*) OVER () AS TOTAL_CNT
        FROM  jmes.TBL_CONTROL A, jmes.TBL_CONTROL_PART B
        WHERE A.CONTROL_SEQ = B.CONTROL_SEQ
            AND A.DEL_YN = 'N'
            AND A.OUT_FINISH_DT IS NULL
            AND B.PART_STATUS = 'PRO004'
        ORDER BY A.CONTROL_SEQ DESC
    </select>

    <select id="selectTvPopList3" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        -- 외주진행
        SELECT
            CASE WHEN B.PART_NUM IS NULL THEN A.CONTROL_NUM ELSE CONCAT(A.CONTROL_NUM,'#',B.PART_NUM) END AS CONTROL_PART_INFO
            , B.IMG_GFILE_SEQ
            , COUNT(*) OVER () AS TOTAL_CNT
        FROM  jmes.TBL_CONTROL A, jmes.TBL_CONTROL_PART B
        WHERE A.CONTROL_SEQ = B.CONTROL_SEQ
            AND A.DEL_YN = 'N'
            AND A.OUT_FINISH_DT IS NULL
            AND B.PART_STATUS = 'PRO001'
        ORDER BY A.CONTROL_SEQ DESC
    </select>

    <select id="selectTvMachineList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        -- 장비
        SELECT X.EQUIP_SEQ
            , X.EQUIP_ID
            , X.EQUIP_NM
            , X.PHOTO_GFILE_SEQ AS EQUIP_PHOTO_GFILE_SEQ
            , X.FACTORY_AREA
            , X.LAYOUT_SORT
            , Y.CONTROL_PART_INFO
            , Y.WORKING_TIME
            , CASE WHEN Y.WORK_STATUS = 'DBS010' THEN 'machine-pause-background'
                   WHEN Y.WORK_STATUS = 'DBS020' THEN 'machine-run-background'
                   ELSE SPACE(0)
              END WORK_STATUS
            , (SELECT M.USER_NM FROM jmes.TBL_USER M WHERE M.USER_ID = X.LOGIN_USER_ID) AS USER_NM
            , (SELECT M.PHOTO_GFILE_SEQ FROM jmes.TBL_USER M WHERE M.USER_ID = X.LOGIN_USER_ID) AS USER_PHOTO_GFILE_SEQ
            , Y.IMG_GFILE_SEQ
        FROM jmes.TBL_EQUIP X
            LEFT OUTER JOIN (
                SELECT A.EQUIP_SEQ, A.WORK_STATUS
                    , SF_GET_DRAWING_WORK_TIME('W_MINUTE', A.MCT_WORK_SEQ) AS WORKING_TIME
                    , CASE WHEN C.PART_NUM IS NULL THEN B.CONTROL_NUM ELSE CONCAT(B.CONTROL_NUM, '#', C.PART_NUM) END AS CONTROL_PART_INFO
                    , C.IMG_GFILE_SEQ
                FROM jmes.TBL_MCT_WORK A, jmes.TBL_CONTROL B, jmes.TBL_CONTROL_PART C
                WHERE A.CONTROL_SEQ = B.CONTROL_SEQ
                    AND A.CONTROL_SEQ = C.CONTROL_SEQ
                    AND A.CONTROL_DETAIL_SEQ = C.CONTROL_DETAIL_SEQ
                    AND A.WORK_STATUS IN ('DBS010', 'DBS020')
                    AND B.OUT_FINISH_DT IS NULL
                    AND A.DEL_YN = 'N'
                    AND B.DEL_YN = 'N'
            ) Y ON X.EQUIP_SEQ = Y.EQUIP_SEQ
        WHERE X.EQUIP_KIND = '1'
            AND X.DEL_YN = 'N'
            AND X.LAYOUT_SORT IS NOT NULL
        ORDER BY X.FACTORY_AREA, X.LAYOUT_SORT
    </select>

    <select id="selectTvAlarmList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT
            SEQ, DATA1, DATA2, DATA3
        FROM jmes.kjw_test
        WHERE SEQ > cast(#{SEQ} as unsigned)
    </select>

    <select id="selectMctAreInfoList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        SELECT
            EQUIP_SEQ, EQUIP_ID, EQUIP_NM,
            (SELECT M.USER_NM FROM jmes.TBL_USER M WHERE M.USER_ID = X.LOGIN_USER_ID) AS USER_NM,
            FACTORY_AREA, LAYOUT_ROW, LAYOUT_COL
        FROM jmes.TBL_EQUIP X
        WHERE EQUIP_KIND = '1'
            AND DEL_YN = 'N'
            AND LAYOUT_ROW IS NOT NULL
            AND LAYOUT_COL IS NOT NULL
        ORDER BY FACTORY_AREA, LAYOUT_ROW, LAYOUT_COL
    </select>
    <select id="selectMctAreList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        -- 상단 (MCT...)
        SELECT X.EQUIP_SEQ
            , X.EQUIP_ID
            , X.EQUIP_NM
            , X.FACTORY_AREA
            , Y.CONTROL_SEQ
            , Y.CONTROL_DETAIL_SEQ
            , (SELECT M.USER_NM FROM jmes.TBL_USER M WHERE M.USER_ID = X.LOGIN_USER_ID) AS USER_NM
            , IFNULL(Y.TOTAL_CNT,0) AS TOTAL_CNT, CONCAT(IFNULL(Y.TOTAL_CNT,0),'품') AS TOTAL_CNT_INFO
            , IFNULL(Y.TOTAL_PART_QTY,0) AS TOTAL_PART_QTY, CONCAT(IFNULL(Y.TOTAL_PART_QTY,0),'EA') AS TOTAL_PART_QTY_INFO
            , IFNULL(Y.TOTAL_PLAN_WORKING_TIME,0) AS TOTAL_PLAN_WORKING_TIME, CONCAT(FLOOR(IFNULL(Y.TOTAL_PLAN_WORKING_TIME,0) / 60), 'H ', MOD(IFNULL(Y.TOTAL_PLAN_WORKING_TIME,0),60), 'M') AS TOTAL_PLAN_WORKING_TIME_INFO
            , jmes.SF_GET_DATE_F(Y.INNER_DUE_DT,'','') AS INNER_DUE_DT
            , Y.WORK_TYPE_NM
            , Y.WORK_PLAN_TYPE
            , Y.KEY_SEQ
            , Y.CONTROL_PART_INFO
            , Y.SIZE_TXT
            , Y.MATERIAL_DETAIL_NM
            , CONCAT(IFNULL(Y.PART_QTY,0),'EA') AS PART_QTY
            , IFNULL(Y.WORKING_TIME,0) AS WORKING_TIME, CONCAT(IFNULL(Y.WORKING_TIME,0),'''') AS WORKING_TIME_INFO
            , IFNULL(Y.PLAN_WORKING_TIME,0) AS PLAN_WORKING_TIME, CONCAT('(',IFNULL(Y.PLAN_WORKING_TIME,0),'''',')') AS PLAN_WORKING_TIME_INFO
            , X.LAYOUT_ROW
            , X.LAYOUT_COL
            , Y.IMG_GFILE_SEQ
            , Y.WORK_STATUS
        FROM jmes.TBL_EQUIP X
                LEFT OUTER JOIN ( SELECT COUNT(*) OVER (PARTITION BY T.EQUIP_SEQ) AS TOTAL_CNT
                                        , SUM(T.PART_QTY) OVER (PARTITION BY T.EQUIP_SEQ) AS TOTAL_PART_QTY
                                        , SUM(PLAN_WORKING_TIME) OVER (PARTITION BY T.EQUIP_SEQ) AS TOTAL_PLAN_WORKING_TIME
                                        , T.CONTROL_SEQ
                                        , T.CONTROL_DETAIL_SEQ
                                        , T.WORK_PLAN_TYPE
                                        , T.KEY_SEQ
                                        , T.EQUIP_SEQ
                                        , T.INNER_DUE_DT
                                        , T.WORK_USER_ID
                                        , T.WORK_TYPE_NM
                                        , T.CONTROL_PART_INFO
                                        , T.SIZE_TXT
                                        , T.MATERIAL_DETAIL_NM
                                        , T.PART_QTY
                                        , T.WORKING_TIME
                                        , T.PLAN_WORKING_TIME
                                        , T.IMG_GFILE_SEQ
                                        , T.WORK_STATUS
                                  FROM (    -- 드로잉보드 진행
                                            SELECT '1' AS WORK_PLAN_TYPE
                                                , C.CONTROL_SEQ
                                                , C.CONTROL_DETAIL_SEQ
                                                , A.MCT_WORK_SEQ AS KEY_SEQ
                                                , A.EQUIP_SEQ
                                                , C.INNER_DUE_DT
                                                , A.WORK_USER_ID
                                                , jmes.SF_GET_CODE_NM('1033', C.WORK_TYPE, 'KR') AS WORK_TYPE_NM
                                                , CASE WHEN C.PART_NUM IS NULL THEN B.CONTROL_NUM ELSE CONCAT(B.CONTROL_NUM, '#', C.PART_NUM) END AS CONTROL_PART_INFO
                                                , C.SIZE_TXT
                                                , jmes.SF_GET_CODE_NM('1027', C.MATERIAL_DETAIL, 'KR') AS MATERIAL_DETAIL_NM
                                                , jmes.SF_GET_CONTROL_PART_QTY(C.CONTROL_SEQ, C.CONTROL_DETAIL_SEQ) AS PART_QTY
                                                , SF_GET_DRAWING_WORK_TIME('W_MINUTE', A.MCT_WORK_SEQ) AS WORKING_TIME
                                                , 0 AS PLAN_WORKING_TIME
                                                , C.IMG_GFILE_SEQ
                                                , A.WORK_STATUS
                                            FROM jmes.TBL_MCT_WORK A
                                                , jmes.TBL_CONTROL B
                                                , jmes.TBL_CONTROL_PART C
                                            WHERE A.CONTROL_SEQ = B.CONTROL_SEQ
                                                AND A.CONTROL_SEQ = C.CONTROL_SEQ
                                                AND A.CONTROL_DETAIL_SEQ = C.CONTROL_DETAIL_SEQ
                                                AND A.WORK_STATUS IN ('DBS010', 'DBS020')
                                                <!-- AND B.OUT_FINISH_DT IS NULL -->
                                                AND A.DEL_YN = 'N'
                                                <if test="EQUIP_SEQ != null and EQUIP_SEQ != ''">
                                                    AND A.EQUIP_SEQ = #{EQUIP_SEQ}
                                                </if>
                                                AND EXISTS (SELECT 1 FROM jmes.TBL_EQUIP D WHERE A.EQUIP_SEQ = D.EQUIP_SEQ AND D.EQUIP_KIND = '1' AND D.DEL_YN = 'N'
                                                    AND D.FACTORY_AREA IN ('ARE01', 'ARE02', 'ARE11', 'ARE05', 'ARE06')
                                                )
                                            UNION ALL
                                            -- PLAN
                                            SELECT '2' AS WORK_PLAN_TYPE
                                                , C.CONTROL_SEQ
                                                , C.CONTROL_DETAIL_SEQ
                                                , A.MCT_PLAN_SEQ AS KEY_SEQ
                                                , A.EQUIP_SEQ
                                                , C.INNER_DUE_DT
                                                , '' AS WORK_USER_ID
                                                , jmes.SF_GET_CODE_NM('1033', C.WORK_TYPE, 'KR') AS WORK_TYPE_NM
                                                , CASE WHEN C.PART_NUM IS NULL THEN B.CONTROL_NUM ELSE CONCAT(B.CONTROL_NUM, '#', C.PART_NUM) END AS CONTROL_PART_INFO
                                                , C.SIZE_TXT
                                                , jmes.SF_GET_CODE_NM('1027', C.MATERIAL_DETAIL, 'KR') AS MATERIAL_DETAIL_NM
                                                , jmes.SF_GET_CONTROL_PART_QTY(C.CONTROL_SEQ, C.CONTROL_DETAIL_SEQ) AS PART_QTY
                                                , 0 AS WORKING_TIME
                                                , IFNULL(A.WORKING_TIME,0) AS PLAN_WORKING_TIME
                                                , C.IMG_GFILE_SEQ
                                                , '' AS WORK_STATUS
                                            FROM jmes.TBL_MCT_PLAN A
                                                , jmes.TBL_CONTROL B
                                                , jmes.TBL_CONTROL_PART C
                                            WHERE A.CONTROL_SEQ = B.CONTROL_SEQ
                                                AND A.CONTROL_SEQ = C.CONTROL_SEQ
                                                AND A.CONTROL_DETAIL_SEQ = C.CONTROL_DETAIL_SEQ
                                                <!-- AND B.OUT_FINISH_DT IS NULL -->
                                                AND A.DEL_YN = 'N'
                                                <if test="EQUIP_SEQ != null and EQUIP_SEQ != ''">
                                                    AND A.EQUIP_SEQ = #{EQUIP_SEQ}
                                                </if>
                                                AND EXISTS (SELECT 1 FROM jmes.TBL_EQUIP D WHERE A.EQUIP_SEQ = D.EQUIP_SEQ AND D.EQUIP_KIND = '1' AND D.DEL_YN = 'N'
                                                    AND D.FACTORY_AREA IN ('ARE01', 'ARE02', 'ARE11', 'ARE05', 'ARE06')
                                                )
                                        ) T
                                   ) Y
                            ON X.EQUIP_SEQ = Y.EQUIP_SEQ
        WHERE Y.KEY_SEQ IS NOT NULL
            <if test="EQUIP_SEQ != null and EQUIP_SEQ != ''">
                AND X.EQUIP_SEQ = #{EQUIP_SEQ}
            </if>
        ORDER BY X.FACTORY_AREA, X.LAYOUT_ROW, X.LAYOUT_COL, Y.WORK_PLAN_TYPE, Y.INNER_DUE_DT, Y.CONTROL_PART_INFO
    </select>

    <select id="selectMctGrid1List" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        -- 하단 그리드 1 (불량/반품 발생 현황)
        SELECT
            COUNT(*) OVER (PARTITION BY 1) AS TOTAL_COUNT
            , jmes.SF_GET_DATE_F(Z.INSERT_DT,'YY','') AS INSPECT_DT
            , ( SELECT N.COMP_NM
                FROM jmes.TBL_CONTROL M, jmes.TBL_COMPANY N
                WHERE M.ORDER_COMP_CD = N.COMP_CD
                    AND M.CONTROL_SEQ = Z.CONTROL_SEQ) AS ORDER_COMP_NM
            , jmes.SF_GET_CONTROL_PART_INFO(Z.CONTROL_SEQ, Z.CONTROL_DETAIL_SEQ) AS CONTROL_PART_INFO
            , CASE WHEN Z.INSPECT_TYPE = '1' THEN '불량'
                   WHEN Z.INSPECT_TYPE = '2' THEN '반품'
              END AS ERROR_TYPE
            , Z.ERROR_QTY, CONCAT(Z.ERROR_QTY,'ea') AS ERROR_QTY_INFO
            , (SELECT jmes.SF_GET_DATE_F(M.INNER_DUE_DT,'YY','') FROM jmes.TBL_CONTROL_PART M WHERE M.CONTROL_SEQ = Z.CONTROL_SEQ AND M.CONTROL_DETAIL_SEQ = Z.CONTROL_DETAIL_SEQ) AS INNER_DUE_DT
            , CASE WHEN Z.INSPECT_TYPE = '1' THEN jmes.SF_GET_CODE_NM('1020', Z.INSPECT_RESULT, 'KR')
                   WHEN Z.INSPECT_TYPE = '2' THEN jmes.SF_GET_CODE_NM('1021', Z.INSPECT_RESULT, 'KR')
              END AS INSPECT_RESULT_NM
            , jmes.SF_GET_CODE_NM('1025', Z.ERROR_ACTION, 'KR') AS ERROR_ACTION_NM
        FROM (
        	SELECT
        		A.CONTROL_SEQ, A.CONTROL_DETAIL_SEQ, A.INSPECT_TYPE, A.ERROR_QTY, A.INSPECT_RESULT, A.ERROR_ACTION, A.INSERT_DT
        	FROM jmes.TBL_INSPECT A
        	WHERE A.INSPECT_TYPE = '1' AND A.INSPECT_GRADE = 'GRD040'
        		AND A.INSPECT_SEQ = (SELECT MAX(B.INSPECT_SEQ) FROM jmes.TBL_INSPECT B WHERE B.INSPECT_TYPE = '1' AND A.CONTROL_SEQ = B.CONTROL_SEQ
        			AND A.CONTROL_DETAIL_SEQ = B.CONTROL_DETAIL_SEQ
        			GROUP BY B.CONTROL_SEQ, B.CONTROL_DETAIL_SEQ
        		)
        	UNION ALL
        	SELECT
        		A.CONTROL_SEQ, A.CONTROL_DETAIL_SEQ, A.INSPECT_TYPE, A.ERROR_QTY, A.INSPECT_RESULT, A.ERROR_ACTION, A.INSERT_DT
        	FROM jmes.TBL_INSPECT A
        	WHERE A.INSPECT_TYPE = '2' AND A.RETURN_SETTLEMENT_DT IS NULL
        )Z
        GROUP BY Z.CONTROL_SEQ, Z.CONTROL_DETAIL_SEQ, Z.INSPECT_TYPE
        ORDER BY Z.INSERT_DT DESC
        LIMIT 5
    </select>
    <select id="selectMctGrid2List" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        -- 하단 그리드 2 (긴급주문 진행현황)
        SELECT
            COUNT(*) OVER (PARTITION BY 1) AS TOTAL_COUNT
        	, B.CONTROL_SEQ, B.CONTROL_DETAIL_SEQ
            , jmes.SF_GET_DATE_F(B.INNER_DUE_DT,'YYYY','') AS INNER_DUE_DT
            , (SELECT M.COMP_NM FROM jmes.TBL_COMPANY M WHERE M.COMP_CD = A.ORDER_COMP_CD) AS ORDER_COMP_NM
            , jmes.SF_GET_CONTROL_PART_INFO(B.CONTROL_SEQ, B.CONTROL_DETAIL_SEQ) AS CONTROL_PART_INFO
            , CONCAT(jmes.SF_GET_CONTROL_PART_QTY(B.CONTROL_SEQ, B.CONTROL_DETAIL_SEQ),'ea') AS CONTROL_PART_QTY_INFO
            , jmes.SF_GET_CODE_NM('1013', B.PART_STATUS, 'KR') AS PART_STATUS_NM
            , SF_GET_CODE_NM(1009, C.POP_POSITION, 'KR') AS POP_POSITION_NM
        FROM jmes.TBL_CONTROL A, jmes.TBL_CONTROL_PART B
        	LEFT OUTER JOIN jmes.TBL_POP C ON C.CONTROL_SEQ = B.CONTROL_SEQ AND C.CONTROL_DETAIL_SEQ = B.CONTROL_DETAIL_SEQ
        		AND C.POP_SEQ = (SELECT MAX(D.POP_SEQ) FROM jmes.TBL_POP D WHERE C.CONTROL_SEQ = D.CONTROL_SEQ AND C.CONTROL_DETAIL_SEQ = D.CONTROL_DETAIL_SEQ
        					GROUP BY D.CONTROL_SEQ, D.CONTROL_DETAIL_SEQ)
        WHERE A.CONTROL_SEQ = B.CONTROL_SEQ
            -- AND A.CONTROL_STATUS IN ('ORD001','ORD003')
            AND A.DEL_YN = 'N'
            AND A.EMERGENCY_YN = 'Y'
            AND IFNULL(B.OUTSIDE_YN, 'N') = 'N'
            AND B.INNER_WORK_FINISH_DT IS NULL
        ORDER BY B.INNER_DUE_DT, A.ORDER_COMP_CD, A.CONTROL_NUM
        LIMIT 5
    </select>
    <select id="selectMctGrid3List" parameterType="java.util.HashMap" resultType="java.util.HashMap">
        -- 하단 그리드 3 (가공지연목록)
        SELECT
            COUNT(*) OVER (PARTITION BY 1) AS TOTAL_COUNT
            , B.CONTROL_SEQ, B.CONTROL_DETAIL_SEQ
            , jmes.SF_GET_DATE_F(B.INNER_DUE_DT,'YYYY','') AS INNER_DUE_DT
            , (SELECT M.COMP_NM FROM jmes.TBL_COMPANY M WHERE M.COMP_CD = A.ORDER_COMP_CD) AS ORDER_COMP_NM
            , jmes.SF_GET_CONTROL_PART_INFO(B.CONTROL_SEQ, B.CONTROL_DETAIL_SEQ) AS CONTROL_PART_INFO
            , CONCAT(jmes.SF_GET_CONTROL_PART_QTY(B.CONTROL_SEQ, B.CONTROL_DETAIL_SEQ),' ea') AS CONTROL_PART_QTY_INFO
            , jmes.SF_GET_CODE_NM('1013', B.PART_STATUS, 'KR') AS PART_STATUS_NM
            , (SELECT M.USER_NM FROM jmes.TBL_USER M, jmes.TBL_COMPANY N WHERE M.USER_ID = N.CHARGE_USER_ID AND N.COMP_CD = A.ORDER_COMP_CD) AS CHARGE_USER_NM
        FROM jmes.TBL_CONTROL A, jmes.TBL_CONTROL_PART B
        WHERE A.CONTROL_SEQ = B.CONTROL_SEQ
            AND A.DEL_YN = 'N'
            AND A.CONTROL_STATUS IN ('ORD001','ORD003')
            AND A.OUT_FINISH_DT IS NULL
            AND B.INNER_WORK_FINISH_DT IS NULL
            AND B.INNER_DUE_DT <![CDATA[ <= ]]> DATE_FORMAT(NOW(),'%Y%m%d')
        ORDER BY B.INNER_DUE_DT, A.ORDER_COMP_CD, A.CONTROL_NUM
        LIMIT 5
    </select>
    <select id="selectMctGrid4List" parameterType="java.util.HashMap" resultType="java.util.HashMap">
            select '1' as data1 from dual
    </select>
    <select id="selectMctInfo" parameterType="java.util.HashMap" resultType="java.util.HashMap">
            select '1' as data1 from dual
    </select>

</mapper>